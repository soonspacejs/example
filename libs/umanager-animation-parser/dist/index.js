import{EventDispatcher as t}from"three";import e from"soonspacejs";const{animation:o}=e,s=Symbol("initialTransform");class i extends t{constructor(t,e){super(),this.ssp=t,this.target=e,this.tweenSet=new Set}initTransform(t){const{position:e,rotation:o,scale:i}=this.target,a=null!=t?t:{position:e.clone(),rotation:o.clone(),scale:i.clone()};return Reflect.set(this.target,s,a),a}getInitialTransform(){return Reflect.get(this.target,s)}async play(t){var e,s,i,a;let n=this.getInitialTransform();n||(n=this.initTransform());for(let r=0;r<t.length;r++){let l=t[r-1];l||(l=n);const c=t[r],p=l.position,h=l.rotation,y=l.scale,d=c.position,g=c.rotation,f=c.scale,m=null!==(e=c.delay)&&void 0!==e?e:0,u=null!==(s=c.duration)&&void 0!==s?s:1e3,x=c.easing,z=-1===c.repeat?1/0:null!==(i=c.repeat)&&void 0!==i?i:0,w=null!==(a=c.yoyo)&&void 0!==a&&a;await o({x:p.x,y:p.y,z:p.z,rotationX:h.x,rotationY:h.y,rotationZ:h.z,scaleX:y.x,scaleY:y.y,scaleZ:y.z},{x:d.x,y:d.y,z:d.z,rotationX:g.x,rotationY:g.y,rotationZ:g.z,scaleX:f.x,scaleY:f.y,scaleZ:f.z},{delay:m,duration:u,mode:x,repeat:z,yoyo:w},((t,e)=>{const{x:o,y:s,z:i,rotationX:a,rotationY:n,rotationZ:r,scaleX:l,scaleY:c,scaleZ:p}=t;this.target.position.set(o,s,i),this.target.rotation.set(a,n,r),this.target.scale.set(l,c,p),this.dispatchEvent({type:"update",source:t,tween:e})}),(t=>{this.tweenSet.add(t),this.dispatchEvent({type:"start",tween:t})}))}}stop(){this.tweenSet.forEach((t=>t.stop())),this.tweenSet.clear()}reset(){const t=this.getInitialTransform();if(t){const{position:e,rotation:o,scale:s}=t;this.target.position.copy(e),this.target.rotation.set(o.x,o.y,o.z),this.target.scale.copy(s),this.ssp.render()}}dispose(){this.stop(),this.reset(),Reflect.deleteProperty(this.target,s)}}export{i as AnimationPlayer};
